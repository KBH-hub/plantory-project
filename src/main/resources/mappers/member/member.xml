<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zero.plantory.domain.member.mapper.MemberMapper">

    <select id="countByMembername" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE membername = #{membername}
          AND del_flag IS NULL
    </select>

    <select id="countByNickname" resultType="int">
        SELECT COUNT(*)
        FROM member
        WHERE nickname = #{nickname}
          AND del_flag IS NULL
    </select>

    <insert id="insertMember" parameterType="com.zero.plantory.global.vo.MemberVO">
        INSERT INTO member (
            membername, password, nickname,
            phone, address,
            sharing_rate, skill_rate, management_rate,
            role, stop_day, del_flag,
            created_at, notice_enabled
        )
        VALUES (
                   #{membername}, #{password}, #{nickname},
                   #{phone}, #{address},
                   #{sharingRate}, #{skillRate}, #{managementRate},
                   #{role}, #{stopDay}, #{delFlag},
                   NOW(), #{noticeEnabled}
               )
    </insert>

    <select id="selectByMembername" resultType="com.zero.plantory.global.vo.MemberVO">
        SELECT member_id, membername, password, nickname, phone, address,
               sharing_rate, skill_rate, management_rate,
               role, stop_day, del_flag
        FROM member
        WHERE membername = #{membername}
          AND del_flag IS NULL
    </select>

    <select id="selectByMemberInfo" resultType="com.zero.plantory.global.vo.MemberVO" parameterType="Long">
        SELECT
            member_id,
            nickname,
            phone,
            address,
            sharing_rate
        FROM member
        WHERE member_id = #{memberId}
    </select>

    <select id="countByInterestCount" resultType="int" parameterType="Long">
        SELECT COUNT(interest_id) AS interest_count
        FROM interest
        WHERE member_id = #{memberId}
    </select>

    <select id="countByCompletedSharingCount" resultType="int" parameterType="Long">
        SELECT COUNT(sharing_id) AS completed_count
        FROM sharing
        WHERE status = 'true'
          AND (member_id = #{memberId} OR target_member_id = #{memberId})
    </select>

    <select id="selectMyWrittenList" resultType="com.zero.plantory.domain.member.vo.MyWrittenListVO" parameterType="com.zero.plantory.domain.member.dto.request.MyWrittenListRequestVO">
        SELECT
            s.sharing_id,
            s.member_id,
            m.nickname,
            s.title,
            s.created_at
        FROM sharing s
                 JOIN member m ON s.member_id = m.member_id
        WHERE s.member_id = #{memberId}
          AND s.del_flag IS NULL
        ORDER BY s.created_at DESC
            LIMIT #{limit} OFFSET #{offset}
    </select>

<!--    <select id="selectMyWrittenList" resultType="com.zero.plantory.domain.member.vo.MyWrittenListVO"-->
<!--            parameterType="com.zero.plantory.domain.member.dto.request.MyWrittenListRequestVO">-->

<!--        <choose>-->

<!--            <when test="category == 'ALL'">-->
<!--                (SELECT-->
<!--                s.sharing_id AS id,-->
<!--                s.member_id,-->
<!--                m.nickname,-->
<!--                s.title,-->
<!--                s.created_at,-->
<!--                'SHARING' AS category-->
<!--                FROM sharing s-->
<!--                JOIN member m ON s.member_id = m.member_id-->
<!--                WHERE s.member_id = #{memberId}-->
<!--                AND s.del_flag IS NULL-->
<!--                <if test="keyword != null and keyword != ''">-->
<!--                    AND s.title LIKE CONCAT('%', #{keyword}, '%')-->
<!--                </if>-->
<!--                )-->
<!--                UNION ALL-->
<!--                (SELECT-->
<!--                q.question_id AS id,-->
<!--                q.member_id,-->
<!--                m.nickname,-->
<!--                q.title,-->
<!--                q.created_at,-->
<!--                'QUESTION' AS category-->
<!--                FROM question q-->
<!--                JOIN member m ON q.member_id = m.member_id-->
<!--                WHERE q.member_id = #{memberId}-->
<!--                AND q.del_flag IS NULL-->
<!--                <if test="keyword != null and keyword != ''">-->
<!--                    AND q.title LIKE CONCAT('%', #{keyword}, '%')-->
<!--                </if>-->
<!--                )-->
<!--                ORDER BY created_at DESC-->
<!--                LIMIT #{limit} OFFSET #{offset}-->
<!--            </when>-->

<!--            <when test="category == 'SHARING'">-->
<!--                SELECT-->
<!--                s.sharing_id AS id,-->
<!--                s.member_id,-->
<!--                m.nickname,-->
<!--                s.title,-->
<!--                s.created_at,-->
<!--                'SHARING' AS category-->
<!--                FROM sharing s-->
<!--                JOIN member m ON s.member_id = m.member_id-->
<!--                WHERE s.member_id = #{memberId}-->
<!--                AND s.del_flag IS NULL-->
<!--                <if test="keyword != null and keyword != ''">-->
<!--                    AND s.title LIKE CONCAT('%', #{keyword}, '%')-->
<!--                </if>-->
<!--                ORDER BY s.created_at DESC-->
<!--                LIMIT #{limit} OFFSET #{offset}-->
<!--            </when>-->

<!--            <otherwise>-->
<!--                SELECT-->
<!--                q.question_id AS id,-->
<!--                q.member_id,-->
<!--                m.nickname,-->
<!--                q.title,-->
<!--                q.created_at,-->
<!--                'QUESTION' AS category-->
<!--                FROM question q-->
<!--                JOIN member m ON q.member_id = m.member_id-->
<!--                WHERE q.member_id = #{memberId}-->
<!--                AND q.del_flag IS NULL-->
<!--                <if test="keyword != null and keyword != ''">-->
<!--                    AND q.title LIKE CONCAT('%', #{keyword}, '%')-->
<!--                </if>-->
<!--                ORDER BY q.created_at DESC-->
<!--                LIMIT #{limit} OFFSET #{offset}-->
<!--            </otherwise>-->

<!--        </choose>-->
<!--    </select>-->

</mapper>
